{% extends '../index.html' %}
{% load static %}
{% block title %}Create Article{% endblock %}

{% block css %}
<link rel="stylesheet" href="{% static 'layout/css/wiki-article.css' %}">
{% endblock %}

{% block content%}

<div class="alert alert-warning alert-dismissble fade show" role="alert">
  <div class="container py-4">
    <div class="clearfix">
      <h4 class="alert-heading float-start">
        <i class="bi bi-exclamation-triangle-fill"></i>
        경고
      </h4>
      <button type="button" class="btn-close float-end" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    <p>당신의 게시글은 다음을 이유로 운영진에 의해 삭제될 수 있으며, 사항에 따라 영구적으로 활동 정지 당할 수 있습니다.</p>
    <hr>
    <ul>
      <li>주제에 벗어나거나 부적절한 표제어를 등록한 경우</li>
      <li>인용을 밝히지 않은 경우</li>
      <li>영리법인에 대한 광고성 내용이 포함된 경우</li>
      <li>기타</li>
    </ul>
    <p>Aww yeah, you successfully read this important alert message. This example text is going to run a bit longer so that you can see how spacing within an alert works with this kind of content.</p>
  </div>
</div>

<div class="container py-4">
  <div id="article-editor-create">
    {%  include './articleEditor.html' %}
  </div>
</div>
{% endblock %}

{% block js %}
<script src="{% static 'node_modules/marked/marked.min.js' %}"></script>
<script src="{% static 'node_modules/katex/dist/katex.min.js'%}"></script>
<script src="{% static 'layout/js/katex-renderer.js' %}"></script>

<script>
  // create
  const isWaitingForHw = JSON.parse("{% if wf_headword %}true{% else %}false{% endif %}");
  if (isWaitingForHw) {
    defaultHwValue = "{{ wf_headword.headword | escapejs }}"
    defaultHwIsValid = true
  } else {
    defaultHwValue = null
    defaultHwIsValid = false
  }
  const hwsExist = JSON.parse("{{ headwords | escapejs }}")
  const defaultMsg = {
    div: '필수: 분류 선택',
    headword: '필수: 128자 이내',
    definition: '필수: Markdown, MathJax 지원',
    description: '선택: Markdown, MathJax 지원',
    keywords: '선택: "," 구분자로 작성. 예를 들어, "keyword1, keyword2, keyword3"'
  }

  Vue.createApp({
    data() {
      return {
        div: {
          value: null,
          isValid: false,
          msg: defaultMsg.div,
        },
        headword: {
          value: defaultHwValue,
          isValid: defaultHwIsValid,
          msg: defaultMsg.headword,
        },
        definition: {
          value: null,
          isValid: false,
          msg: defaultMsg.definition,
        },
        description: {
          value: null,
          isValid: true,
          msg: defaultMsg.description,
        },
        keywords: {
          value: null,
          isValid: true,
          msg: defaultMsg.keywords,
        },
        isDisabledButton: null,
      }
    },
    computed: {
      compiledMarkdown() {
        return marked.parse(
        `${this.definition.value}\n\n\n*keywords: ${this.keywords.value}*\n\n---\n\n${this.description.value}`
        )
      },
      checkForm() {
        this.isDisabledButton = !(
          this.div.isValid
          && this.headword.isValid
          && this.definition.isValid
          && this.description.isValid
          && this.keywords.isValid
        )
      }
    },
    methods: {
      checkDivForm() {
        if (this.div.value !== null) {
          this.div.isValid = true
          this.div.msg = "필수: 선택 완료"
        } else {
          this.div.isValid = true
          this.div.msg = defaultMsg.div
        }
      },
      checkHeadwordForm() {
        if (this.headword.value === null) {
          this.headword.isValid = false
          this.headword.msg = defaultMsg.headword
        } else if (this.headword.value.length > 128) {
          this.headword.isValid = false
          this.headword.msg = "너무 긴 표제어입니다. 128자 이내로 작성바랍니다."
        } else if (hwsExist.includes(this.headword.value)) {
          this.headword.isValid = false
          this.headword.msg = "이미 해당 표제어에 대한 게시글이 존재합니다."
        } else {
          this.headword.isValid = true
          this.headword.msg = defaultMsg.headword
        }
      },
      checkDefinitionForm() {
        if (this.definition.value === null) {
          this.definition.isValid = false
        } else {
          this.definition.isValid = true
        };
      },
      checkDescriptionForm() {
      },
      checkKeywordsForm() {
      }
    }
  }).mount("#article-editor-create")
</script>
{% endblock %}
